<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>DC Metro Prediction Board - Kevin Craig</title><meta name="Description" content="Python implementation of DC Metro API on LED Board"><meta property="og:title" content="DC Metro Prediction Board" />
<meta property="og:description" content="Python implementation of DC Metro API on LED Board" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kevcraig.github.io/dc-metro-prediction-board/" /><meta property="og:image" content="https://kevcraig.github.io/dc-metro-prediction-board/featured-image-preview.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-17T17:55:28+08:00" />
<meta property="article:modified_time" content="2021-12-27T17:55:28+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://kevcraig.github.io/dc-metro-prediction-board/featured-image-preview.jpg"/>
<meta name="twitter:title" content="DC Metro Prediction Board"/>
<meta name="twitter:description" content="Python implementation of DC Metro API on LED Board"/>
<meta name="application-name" content="Kevin Craig">
<meta name="apple-mobile-web-app-title" content="Kevin Craig"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kevcraig.github.io/dc-metro-prediction-board/" /><link rel="prev" href="https://kevcraig.github.io/scratcherstats/" /><link rel="next" href="https://kevcraig.github.io/disc-video-recognition/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "DC Metro Prediction Board",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kevcraig.github.io\/dc-metro-prediction-board\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/kevcraig.github.io\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","wordcount":  721 ,
        "url": "https:\/\/kevcraig.github.io\/dc-metro-prediction-board\/","datePublished": "2021-06-17T17:55:28+08:00","dateModified": "2021-12-27T17:55:28+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/kevcraig.github.io\/images\/avatar.png",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Kevin"
            },"description": "Python implementation of DC Metro API on LED Board"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kevin Craig">Kevin Craig</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/posts/"> Posts &amp; Projects </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kevin Craig">Kevin Craig</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/posts/" title="">Posts &amp; Projects</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">DC Metro Prediction Board</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Kevin</a></span>&nbsp;<span class="post-category">included in <a href="/categories/projects/"><i class="far fa-folder fa-fw"></i>Projects</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-06-17">2021-06-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;721 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;4 minutes&nbsp;</div>
        </div><div class="content" id="content"><figure><img src="Metro-Sign-Image-1.jpg"/>
</figure>

<h2 id="overview">Overview</h2>
<p>In April, I wrote about a <a href="https://kevcraig.github.io/DC%20Metro%20Network%20Analysis/" target="_blank" rel="noopener noreffer">network analysis</a> of the DC metro system. In the process of finding metro data for that project, I gained developer access to the WMATA metro API. One endpoint of the API was current predictions for each train and station within the DC metro network, which sparked an idea for a DIY metro board for my U-Street apartment. The goal was to build something that resembles the actual train prediction screens found in DC metro stations but have it in my own living room, all made possible by the WMATA API and some hardware found on the internet.</p>
<h2 id="process">Process</h2>
<p>Now that the project is complete, I wanted to share my process and what I learned in my first project dealing with both hardware &amp; software. All the code is on my <a href="https://github.com/kevcraig/LED-Metro-Sign" target="_blank" rel="noopener noreffer">Github</a> and can be cloned if you want to build a board for your own WMATA station.</p>
<h3 id="hardware">Hardware:</h3>
<p>To build a real time metro prediction board, you need a screen, a computer to connect to the screen and API, and a power connection. Hardware costs $118 if you buy everything new from <a href="https://www.adafruit.com/" target="_blank" rel="noopener noreffer">Adafruit</a></p>
<ul>
<li>Raspberry Pi ZeroWH
<ul>
<li>Raspberry Pi with WIFI access and GPIO headers to connect to the AdaFruit Bonnet. Any Raspberry Pi / Arduino with these specs would work, but this was the cheapest option I could find</li>
</ul>
</li>
<li>16GB Micro SD Card
<ul>
<li>SD card used for the Raspberry Pi OS and storage</li>
</ul>
</li>
<li>64 x 32 RGB LED Matrix - 6mm pitch
<ul>
<li>LED Board that displays metro predictions. The pitch is the space between pixels, I choose 6mm</li>
</ul>
</li>
<li>Adafruit RGB Matrix Bonnet for Raspberry Pi</li>
<li>Bonnet hardware between Raspberry Pi and LED board</li>
</ul>
<p>Basic architecture for the system is displayed below:
<figure><img src="Basic_Arch.png"/>
</figure>
</p>
<h3 id="software">Software:</h3>
<p>I thought about software in two groups: code to pull and store train predictions from the WMATA API, and code to display train predictions on the LED board.</p>
<ol>
<li><em>Requirements</em>: Pull and store train predictions from WMATA API</li>
</ol>
<ul>
<li>Connect to the WMATA API through WIFI</li>
<li>Update every 10 seconds</li>
<li>Don’t get rate limited</li>
<li>Store predictions as PNG</li>
<li>Allow user to change station as needed</li>
</ul>
<ol start="2">
<li><em>Requirements</em>: Display train predictions on LED board</li>
</ol>
<ul>
<li>Make sure text fits on board</li>
<li>Refresh text every 10 seconds</li>
</ul>
<p>Pulling WMATA train predictions for a given station every 10 seconds was simple enough through the WMATA&rsquo;s developer API. The harder part was figuring out how to display and update the predictions on the LED board. Luckily, the <a href="https://github.com/hzeller/rpi-rgb-led-matrix" target="_blank" rel="noopener noreffer">rpi-rgb-led-matrix library</a> built by Henner Zeller can be used to control LED panels from a computer like a Raspberry Pi. With the rpi-rgb-led-matrix Python bindings, you can choose to display scrolling text or static images on a single board or string of boards. I preferred the PNG image option so I could display three incoming train predictions at once, which meant I needed to convert JSON API responses to a PNG image file the rpi-rgb-led-matrix library could handle.  I&rsquo;ve played with scraping text off images with OCR packages but had never thought of converting a text to an image. Luckily, the Python Imaging Library (PIL/Pillow) simplified this process to a few lines of code.</p>
<p>A basic process flow for the system is outlined below. The Prod_Prediction_Ticker.py and Prod_Display_Image.py files run concurrently and refresh every 10 seconds.
<figure><img src="Process_Flow.png"/>
</figure>
</p>
<h2 id="what-i-learned-h3">What I learned </h3></h2>
<ul>
<li>
<p>Building something physical is super rewarding</li></p>
<ul>
<li>Most of my projects end up as a model or dashboard. It was fun to make something with a physical end product that I can keep on my desk</li>
</ul>
</li>
<li>
<p>Cloud services are awesome</p>
<ul>
<li>Imaging and setting up a Raspberry Pi for an SSH connection take time and know how. This really puts into perspective how nice it is to spin up an EC2 instance and be ready to code in a couple minutes. Working with a new Linux computer first hand gave me an appreciation for what goes on behind the scenes with VMs.</li>
</ul>
</li>
<li>
<p>Linux is nice to know</li></p>
<ul>
<li>Everything I did on the Raspberry Pi from downloading libraries, scping files, updating python scripts was through the command line. A basic understanding of the useful commands was super important to work quickly. I included useful commands in this project&rsquo;s <a href="" target="_blank"> <a href="https://github.com/kevcraig/LED-Metro-Sign" target="_blank" rel="noopener noreffer">Github repo</a> that I used throughout this project.</li>
</ul>
</li>
</ul>
<p>If you are interested in building one of these for DC or another city with real-time accessible data, let me know!</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-12-27</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/dc-metro-prediction-board/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/scratcherstats/" class="prev" rel="prev" title="ScratcherStatsNC"><i class="fas fa-angle-left fa-fw"></i>ScratcherStatsNC</a>
            <a href="/disc-video-recognition/" class="next" rel="next" title="Pro Disc Golf, Follow Flight, and Computer Vision">Pro Disc Golf, Follow Flight, and Computer Vision<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
